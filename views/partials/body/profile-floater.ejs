<div class="relative" id="profile-floater-container">
  <div class="flex rounded-xl bg-[#F0F0F0] hover:bg-gray-300/70 p-4 gap-x-2 items-center cursor-default md:cursor-pointer" id="profile-floater">
    <div class="rounded-full overflow-hidden">
      <img 
        class="w-10 h-10"
        src="<%= user.picture %>" 
        alt="User's picture"
        width="150"
        height="150"
      />
    </div>
    <p class="flex items-center gap-x-2">
      <span class="font-bold">
        <%= output(user?.UserRole?.role) %>
      </span> 
      <span class="overflow-hidden max-w-[250px] text-ellipsis">
        <%= output(user?.givenName) %>
      </span>
    </p>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
      <path fill-rule="evenodd" d="M12.53 16.28a.75.75 0 01-1.06 0l-7.5-7.5a.75.75 0 011.06-1.06L12 14.69l6.97-6.97a.75.75 0 111.06 1.06l-7.5 7.5z" clip-rule="evenodd" />
    </svg>
  </div>
  <div class="p-4 shadow w-full rounded-lg bg-white absolute invisible -z-50 flex flex-col gap-y-4" id="profile-floater-options">
    <% if (user?.UserRole?.role === 'STUDENT') { %>
      <a class="btn flex gap-x-2" href="#">
        <span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" />
          </svg>          
        </span>
        <span>
          Profile
        </span>
      </a>
    <% } %>
    <a class="btn red flex gap-x-2" href="#" id="signout-btn">
      <span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
          <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm5.03 4.72a.75.75 0 010 1.06l-1.72 1.72h10.94a.75.75 0 010 1.5H10.81l1.72 1.72a.75.75 0 11-1.06 1.06l-3-3a.75.75 0 010-1.06l3-3a.75.75 0 011.06 0z" clip-rule="evenodd" />
        </svg>      
      </span>
      <span>
        Sign out
      </span>
    </a>
    <script nonce="<%= config.NONCE %>">
      (function () {
        const signoutButton = document.querySelector('#signout-btn')
        let abortController = null
        if (!signoutButton) return
        signoutButton.addEventListener('click', async function (e) {
          e.preventDefault()
          if (abortController instanceof AbortController) signal.abort()
          try {
            abortController = new AbortController()
            const response = await fetch('/auth/logout', {
              method: 'POST', 
              signal: abortController.signal
            })
            const { ok } = await response.json()
            if (ok) location.href = '/'
          } catch (error) {
            if (error instanceof Error) alert(error.message)
          }
        })
      })()
    </script>
  </div>
</div>
